# 统一空图横坐标范围修复说明

## 🎯 需求描述

当用户未加载任何数据时，以下三个页面的空白图形应该显示统一的横坐标范围：
1. "平滑处理"页面
2. "基线校正"页面
3. "特征峰分析"页面

**预期行为**：
- 横坐标范围应该设置为：4000 cm⁻¹（左侧）到 400 cm⁻¹（右侧）
- 这符合 FTIR 光谱图的标准波数范围
- 横坐标应该从左到右递减（左大右小），符合 FTIR 标准显示习惯

---

## 🔍 问题分析

### 修复前的情况

**平滑处理页面**：
- 初始化时只创建了空的图形，没有设置默认的横坐标范围
- 横坐标范围由 Matplotlib 自动确定（通常是 0-1）

**基线校正页面**：
- 初始化时只创建了空的图形，没有设置默认的横坐标范围
- 横坐标范围由 Matplotlib 自动确定（通常是 0-1）

**特征峰分析页面**：
- 显示空图时调用了 `invert_xaxis()`，但没有设置具体的横坐标范围
- 横坐标范围由 Matplotlib 自动确定后再倒置

### 问题

1. **不一致**：三个页面的空图横坐标范围不统一
2. **不符合标准**：没有显示 FTIR 光谱图的标准波数范围（4000-400 cm⁻¹）
3. **用户体验差**：用户在未加载数据时看到的是无意义的坐标范围

---

## ✅ 修复方案

### 修复1：平滑处理页面初始化

**代码位置**：第 418-437 行

**修复内容**：
```python
self.smooth_canvas = FigureCanvasTkAgg(self.smooth_fig, master=plot_frame)

# 初始化空图，设置默认横坐标范围（FTIR标准：4000-400 cm⁻¹）
self.smooth_ax1.set_xlabel('波数 (cm$^{-1}$)')
self.smooth_ax1.set_ylabel('吸光度')
self.smooth_ax1.set_xlim(4000, 400)  # 左大右小
self.smooth_ax1.grid(True)

self.smooth_ax2.set_xlabel('波数 (cm$^{-1}$)')
self.smooth_ax2.set_ylabel('吸光度')
self.smooth_ax2.set_xlim(4000, 400)  # 左大右小
self.smooth_ax2.grid(True)

self.smooth_canvas.draw()
self.smooth_canvas.get_tk_widget().pack(fill=tk.BOTH, expand=True)
```

**说明**：
- 在创建画布后，立即设置两个子图的默认横坐标范围
- 使用 `set_xlim(4000, 400)` 设置左大右小的范围
- 添加网格线和坐标轴标签

---

### 修复2：基线校正页面初始化

**代码位置**：第 527-546 行

**修复内容**：
```python
self.baseline_canvas = FigureCanvasTkAgg(self.baseline_fig, master=plot_frame)

# 初始化空图，设置默认横坐标范围（FTIR标准：4000-400 cm⁻¹）
self.baseline_ax1.set_xlabel('波数 (cm$^{-1}$)')
self.baseline_ax1.set_ylabel('吸光度')
self.baseline_ax1.set_xlim(4000, 400)  # 左大右小
self.baseline_ax1.grid(True)

self.baseline_ax2.set_xlabel('波数 (cm$^{-1}$)')
self.baseline_ax2.set_ylabel('吸光度')
self.baseline_ax2.set_xlim(4000, 400)  # 左大右小
self.baseline_ax2.grid(True)

self.baseline_canvas.draw()
self.baseline_canvas.get_tk_widget().pack(fill=tk.BOTH, expand=True)
```

**说明**：
- 与平滑处理页面相同的修复方式
- 确保两个页面的空图显示一致

---

### 修复3：特征峰分析页面显示空图

**代码位置**：第 2476-2485 行

**修复内容**：
```python
if not checked_datasets:
    # 没有勾选的数据集，显示空图
    logger.info("update_peak_plot: 显示空图")
    self.peak_ax.set_xlabel('波数 (cm$^{-1}$)')
    self.peak_ax.set_ylabel('吸光度')
    self.peak_ax.set_xlim(4000, 400)  # 设置默认横坐标范围（左大右小）
    self.peak_ax.grid(True)
    self.peak_fig.tight_layout()
    self.peak_canvas.draw()
    return
```

**说明**：
- 移除了 `invert_xaxis()` 调用（因为已经通过 `set_xlim(4000, 400)` 设置了倒置的范围）
- 添加了 `set_xlim(4000, 400)` 设置默认横坐标范围
- 与其他两个页面保持一致

---

## 📊 修复效果

### 修复前

**平滑处理页面**：
- ❌ 横坐标范围：0-1（Matplotlib 默认）
- ❌ 不符合 FTIR 标准

**基线校正页面**：
- ❌ 横坐标范围：0-1（Matplotlib 默认）
- ❌ 不符合 FTIR 标准

**特征峰分析页面**：
- ❌ 横坐标范围：倒置的 0-1
- ❌ 不符合 FTIR 标准

### 修复后

**平滑处理页面**：
- ✅ 横坐标范围：4000-400 cm⁻¹（左大右小）
- ✅ 符合 FTIR 标准

**基线校正页面**：
- ✅ 横坐标范围：4000-400 cm⁻¹（左大右小）
- ✅ 符合 FTIR 标准

**特征峰分析页面**：
- ✅ 横坐标范围：4000-400 cm⁻¹（左大右小）
- ✅ 符合 FTIR 标准

**统一性**：
- ✅ 三个页面的空图横坐标范围完全一致
- ✅ 都符合 FTIR 光谱图的标准显示习惯

---

## 🧪 测试方法

### 测试步骤

1. **启动程序**
   ```bash
   python FTIR_Processor.py
   ```

2. **测试平滑处理页面**
   - 切换到"平滑处理"页面
   - 观察上下两个子图的横坐标范围
   - 验证：左侧应该显示 4000，右侧应该显示 400

3. **测试基线校正页面**
   - 切换到"基线校正"页面
   - 观察上下两个子图的横坐标范围
   - 验证：左侧应该显示 4000，右侧应该显示 400

4. **测试特征峰分析页面**
   - 切换到"特征峰分析"页面
   - 观察图形的横坐标范围
   - 验证：左侧应该显示 4000，右侧应该显示 400

5. **测试加载数据后的显示**
   - 加载一个数据文件
   - 验证三个页面的图形显示正常
   - 验证横坐标范围根据实际数据自动调整

### 预期结果

**未加载数据时**：
- ✅ 三个页面的空图横坐标范围都是 4000-400 cm⁻¹
- ✅ 横坐标从左到右递减（左大右小）
- ✅ 显示网格线和坐标轴标签

**加载数据后**：
- ✅ 横坐标范围根据实际数据自动调整
- ✅ 保持左大右小的显示习惯
- ✅ 所有功能正常工作

---

## 📝 修改总结

### 修改的文件
- `FTIR_Processor.py`

### 修改的位置
- 第 418-437 行：平滑处理页面初始化，添加默认横坐标范围
- 第 527-546 行：基线校正页面初始化，添加默认横坐标范围
- 第 2476-2485 行：特征峰分析页面显示空图，添加默认横坐标范围

### 不受影响的功能
- ✅ 数据加载
- ✅ 平滑处理
- ✅ 基线校正
- ✅ 寻峰
- ✅ 峰分析
- ✅ 数据导出
- ✅ 日志管理
- ✅ 所有图形缩放和平移功能
- ✅ 所有其他功能

---

## 🎯 技术要点

### FTIR 光谱图的标准波数范围

**波数（Wavenumber）**：
- 单位：cm⁻¹（每厘米的波数）
- 标准范围：**4000-400 cm⁻¹**
- 显示习惯：**高波数在左，低波数在右**

**为什么是 4000-400 cm⁻¹？**
- 这是 FTIR 光谱仪的常用测量范围
- 涵盖了大多数有机和无机化合物的特征吸收峰
- 4000 cm⁻¹ 对应于 O-H、N-H 伸缩振动
- 400 cm⁻¹ 对应于金属-氧键等低频振动

### Matplotlib 坐标轴设置

**方法1：使用 `set_xlim()` 设置倒置范围**
```python
ax.set_xlim(4000, 400)  # 左大右小，自动倒置
```

**方法2：先设置范围，再倒置**
```python
ax.set_xlim(400, 4000)  # 左小右大
ax.invert_xaxis()       # 倒置
```

**本次修复使用方法1**：
- 更简洁，一步到位
- 避免重复调用 `invert_xaxis()` 导致的问题
- 代码更易读

### 为什么移除了 `invert_xaxis()`？

**特征峰分析页面的修复**：
- 修复前：调用 `invert_xaxis()`，但没有设置具体范围
- 修复后：使用 `set_xlim(4000, 400)` 直接设置倒置的范围
- 原因：避免在加载数据后重复调用 `invert_xaxis()` 导致 X 轴被反复倒置

**注意**：
- 在 `update_peak_plot()` 函数的其他部分（加载数据后），仍然调用 `invert_xaxis()`
- 这是因为 `clear()` 会清除坐标轴的所有设置，包括倒置状态
- 所以需要在每次 `clear()` 后重新倒置

---

## 📚 相关文档

- `README.md` - 项目总体说明
- `docs/功能更新总结.md` - 所有功能更新汇总
- `docs/矩形选框横坐标顺序修复说明.md` - 矩形选框横坐标顺序修复说明

---

## 📞 技术支持

如有问题，请查看：
- 日志文件：`logs/ftir_processor.log`
- 项目文档：`README.md`
- 功能更新总结：`docs/功能更新总结.md`

---

## ✅ 总结

**需求**：统一三个页面在未加载数据时的横坐标范围

**修复**：
1. 平滑处理页面：在初始化时设置默认横坐标范围 4000-400 cm⁻¹
2. 基线校正页面：在初始化时设置默认横坐标范围 4000-400 cm⁻¹
3. 特征峰分析页面：在显示空图时设置默认横坐标范围 4000-400 cm⁻¹

**效果**：
- ✅ 三个页面的空图横坐标范围完全一致
- ✅ 符合 FTIR 光谱图的标准显示习惯（4000-400 cm⁻¹，左大右小）
- ✅ 提升了用户体验
- ✅ 不影响加载数据后的正常显示

