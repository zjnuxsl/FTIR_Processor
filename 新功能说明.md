# FTIR_Processor 2.0 增强版 - 新功能说明

## 🎉 版本更新

从 v1.0 升级到 v2.0，增加了大量实用功能，显著提升了处理效率和用户体验。

---

## 🆕 新增功能概览

### 1. **配置管理系统** ⭐⭐⭐

#### 功能说明
保存和加载处理参数配置，避免重复设置。

#### 使用方法
1. **保存配置**：
   - 菜单栏 → 文件 → 保存配置
   - 当前所有处理参数将保存为 JSON 文件
   - 包含：平滑方法及参数、基线校正方法及参数、峰检测参数

2. **加载配置**：
   - 菜单栏 → 文件 → 加载配置
   - 选择之前保存的配置文件
   - 所有参数将自动应用到界面

#### 应用场景
- 处理同类型样品时，保存标准处理流程
- 团队协作时，共享处理参数
- 快速切换不同的处理方案

#### 配置文件示例
```json
{
  "version": "1.0",
  "created_at": "2024-01-15T10:30:00",
  "config": {
    "y_label": "吸光度",
    "smoothing": {
      "method": "savgol",
      "params": {
        "window_length": "11",
        "polyorder": "3"
      }
    },
    "baseline": {
      "method": "rubberband",
      "params": {
        "num_points": "100"
      },
      "data_source": "smoothed"
    },
    "peak_analysis": {
      "threshold": "0.1",
      "distance": "10"
    }
  }
}
```

---

### 2. **批量文件处理** ⭐⭐⭐⭐⭐

#### 功能说明
一次性处理多个FTIR光谱文件，自动应用相同的处理流程。

#### 使用方法
1. **打开批量处理对话框**：
   - 菜单栏 → 文件 → 批量处理

2. **添加待处理文件**：
   - 点击"添加文件"按钮
   - 可一次选择多个 CSV 文件

3. **选择输出目录**：
   - 点击"选择目录"按钮
   - 指定处理结果保存位置

4. **开始处理**：
   - 点击"开始批量处理"
   - 自动应用当前界面设置的处理参数
   - 显示实时进度

#### 输出文件
每个输入文件会生成：
- `文件名_processed.csv` - 包含原始、平滑、校正数据
- `文件名_peaks.csv` - 峰检测结果（如果启用）
- `batch_summary.json` - 批量处理摘要报告

#### 处理摘要示例
```json
{
  "total_files": 10,
  "successful": 10,
  "failed": 0,
  "timestamp": "2024-01-15T10:45:30",
  "results": [
    {
      "filename": "sample1.csv",
      "data_points": 1024,
      "processing_steps": ["smoothing", "baseline", "peak_analysis"],
      "peaks_found": 5
    }
  ]
}
```

#### 应用场景
- 大批量实验数据处理
- 标准化数据处理流程
- 提高工作效率数十倍

---

### 3. **增强的导出功能** ⭐⭐⭐

#### 3.1 导出完整报告 (Excel)

**功能说明**：
将所有处理数据和参数导出到单个 Excel 文件，包含多个工作表。

**使用方法**：
- 菜单栏 → 导出 → 导出完整报告(Excel)

**Excel 工作表结构**：
- **原始数据** - 波数和原始吸光度
- **平滑数据** - 原始和平滑后对比
- **基线校正数据** - 校正后的光谱
- **峰分析** - 检测到的峰位置和高度
- **处理参数** - 完整的处理配置

**优势**：
- 方便归档和分享
- 包含完整的处理信息
- 易于后续分析和报告撰写

#### 3.2 导出数据（带元数据）

**功能说明**：
导出 CSV 文件，在文件头部添加处理参数元数据。

**使用方法**：
- 菜单栏 → 导出 → 导出数据(带元数据)

**输出格式示例**：
```csv
# FTIR Spectral Data
# Export Date: 2024-01-15T10:30:00
# Data Points: 1024
# Processing Config: {"smoothing": {"method": "savgol", ...}}
#
wavenumber,raw,smoothed,corrected
4000.0,0.123,0.125,0.120
3999.5,0.124,0.126,0.121
...
```

**优势**：
- 可追溯的数据处理过程
- 符合科研数据管理规范
- 方便数据复现

---

### 4. **处理流程自动化 (Pipeline)** ⭐⭐⭐

#### 功能说明
自动识别和执行配置的处理步骤，实现端到端的自动化处理。

#### 工作原理
1. 根据配置自动构建处理流程
2. 按照 平滑 → 基线校正 → 峰检测 的顺序执行
3. 自动处理数据源依赖关系

#### 在批量处理中的应用
- 批量处理自动使用 Pipeline
- 确保所有文件使用一致的处理流程
- 减少人为操作错误

---

## 📋 完整功能列表对比

| 功能类别 | v1.0 | v2.0 增强版 |
|---------|------|------------|
| **数据处理** | | |
| 平滑方法 | 5种 | 5种 ✅ |
| 基线校正 | 5种 | 5种 ✅ |
| 峰分析 | ✅ | ✅ |
| **配置管理** | | |
| 保存配置 | ❌ | ✅ **新增** |
| 加载配置 | ❌ | ✅ **新增** |
| **批量处理** | | |
| 单文件处理 | ✅ | ✅ |
| 批量处理 | ❌ | ✅ **新增** |
| 进度显示 | ❌ | ✅ **新增** |
| 处理报告 | ❌ | ✅ **新增** |
| **数据导出** | | |
| CSV 导出 | ✅ | ✅ |
| Excel 多表导出 | ❌ | ✅ **新增** |
| 元数据导出 | ❌ | ✅ **新增** |
| **用户界面** | | |
| 菜单栏 | ❌ | ✅ **新增** |
| 帮助系统 | ✅ | ✅ 增强 |
| 关于对话框 | ❌ | ✅ **新增** |

---

## 🚀 快速开始

### 安装依赖

```bash
# 安装所有依赖
pip install -r requirements.txt
```

### 运行程序

```bash
python FTIR_Processor.py
```

### 典型工作流程

#### 单文件处理
1. 加载数据
2. 选择平滑方法并调整参数
3. 执行平滑
4. 选择基线校正方法
5. 执行校正
6. 进行峰分析
7. 导出结果

#### 批量处理工作流
1. **准备阶段**：
   - 使用单个样品调试最佳处理参数
   - 保存配置（文件 → 保存配置）

2. **批量处理**：
   - 打开批量处理对话框（文件 → 批量处理）
   - 添加所有待处理文件
   - 选择输出目录
   - 开始批量处理

3. **结果检查**：
   - 查看输出目录中的处理结果
   - 检查 `batch_summary.json` 摘要

---

## 💡 使用技巧

### 技巧 1：创建标准处理方案库
为不同类型的样品创建配置文件：
- `FTIR_protein.json` - 蛋白质样品标准流程
- `FTIR_polymer.json` - 聚合物样品标准流程
- `FTIR_mineral.json` - 矿物样品标准流程

### 技巧 2：批量处理前先测试
在批量处理前，先用代表性样品测试处理效果：
1. 选择1-2个典型样品
2. 调试参数直到满意
3. 保存配置
4. 应用到批量处理

### 技巧 3：使用 Excel 导出制作报告
Excel 导出包含所有数据和参数，可直接用于：
- 科研论文附件
- 实验报告数据表
- 与团队成员分享

### 技巧 4：元数据导出保证可追溯性
使用带元数据的 CSV 导出：
- 记录完整的处理参数
- 便于数据归档
- 符合 FAIR 数据原则

---

## 🔧 技术架构

### 模块化设计

```
FTIR_Processor/
├── FTIR_Processor.py      # 主程序（GUI + 核心功能）
├── config_manager.py       # 配置管理模块
├── batch_processor.py      # 批量处理模块
├── requirements.txt        # 依赖声明
└── test.CSV               # 测试数据
```

### 关键类说明

- **SpectralProcessorGUI** - 主界面类
- **ConfigManager** - 配置保存/加载管理
- **ProcessingPipeline** - 处理流程自动化
- **BatchProcessor** - 批量文件处理器
- **ExportManager** - 导出管理器
- **BatchDialog** - 批量处理对话框

---

## 🐛 问题排查

### Q: 菜单栏中的增强功能显示"模块未安装"
**A**: 确保 `config_manager.py` 和 `batch_processor.py` 在同一目录下

### Q: Excel 导出失败
**A**: 确保安装了 openpyxl：`pip install openpyxl`

### Q: 批量处理卡住不动
**A**: 检查输入文件格式是否正确（至少2列数据）

### Q: 配置加载后参数没有变化
**A**: 确保配置文件格式正确，检查 JSON 语法

---

## 📈 性能说明

### 批量处理性能
- 单文件处理时间：~0.5-2秒（取决于数据点数）
- 100个文件批量处理：~1-3分钟
- 支持的最大文件数：理论无限制（受内存限制）

### 内存使用
- 单文件：< 50 MB
- 批量处理：随文件数线性增长
- 建议：处理大量文件时分批进行

---

## 🎯 未来规划

以下功能在后续版本中可能添加：

1. **撤销/重做功能** - 允许撤销处理操作
2. **实时预览** - 调整参数时实时显示效果
3. **更多导出格式** - 支持 MATLAB .mat、JSON 等
4. **图形渲染优化** - 提升大数据集绘图性能
5. **自定义处理算法** - 允许用户添加自定义处理方法
6. **数据对比视图** - 同时查看多个样品的光谱
7. **报告模板** - 自动生成Word/PDF报告

---

## 📞 技术支持

**作者**: zjnuxsl
**邮箱**: sl-xiao@zjnu.cn
**版本**: 2.0 (2024)

如有问题或建议，欢迎通过邮件联系。

---

## 📄 许可证

本程序仅供学术研究使用。

---

## 🙏 致谢

感谢以下开源项目：
- NumPy - 数值计算
- Pandas - 数据处理
- Matplotlib - 可视化
- SciPy - 科学计算
- pybaselines - 基线校正
- statsmodels - 统计分析

---

**更新日期**: 2024-01-15
**文档版本**: 1.0
