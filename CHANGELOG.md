# 更新日志 (Changelog)

## [2.0.0] - 2024-01-15

### ✨ 新增功能 (Added)

#### 配置管理
- ✅ 添加配置保存功能 - 将当前处理参数保存为 JSON 文件
- ✅ 添加配置加载功能 - 从文件加载处理参数
- ✅ 配置文件包含版本信息和时间戳
- ✅ 自动识别和适配不同版本的配置文件

#### 批量处理
- ✅ **批量文件处理功能** - 一次处理多个文件
- ✅ 批量处理对话框 - 友好的图形界面
- ✅ 实时进度显示 - 进度条和状态文本
- ✅ 多线程处理 - 不阻塞主界面
- ✅ 批量处理摘要报告 - JSON 格式记录所有处理结果
- ✅ 错误处理和日志 - 记录失败的文件

#### 数据导出
- ✅ **Excel 完整报告导出** - 多工作表包含所有数据
  - 原始数据工作表
  - 平滑数据工作表
  - 基线校正数据工作表
  - 峰分析结果工作表
  - 处理参数工作表
- ✅ **CSV 元数据导出** - 在文件头部添加处理参数
- ✅ 导出文件包含时间戳和配置信息

#### 用户界面
- ✅ **菜单栏** - 专业的菜单结构
  - 文件菜单：加载、保存配置、批量处理、退出
  - 导出菜单：多种导出格式
  - 帮助菜单：方法说明、关于
- ✅ 关于对话框 - 显示程序信息和功能特性

#### 处理流程
- ✅ **ProcessingPipeline 类** - 自动化处理流程
- ✅ 智能依赖处理 - 自动处理数据源依赖关系
- ✅ 可配置的处理步骤顺序

### 🔧 改进 (Changed)

#### 代码结构
- ✅ 模块化设计 - 分离配置管理和批量处理逻辑
- ✅ 新增 `config_manager.py` 模块
- ✅ 新增 `batch_processor.py` 模块
- ✅ 改进导入语句 - 更好的错误处理

#### 依赖管理
- ✅ 创建 `requirements.txt` - 明确列出所有依赖
- ✅ 可选依赖支持 - 增强功能模块可选安装
- ✅ 向后兼容 - 没有增强模块也能运行基本功能

#### 文档
- ✅ 创建详细的新功能说明文档
- ✅ 提供配置文件示例
- ✅ 添加更新日志
- ✅ 改进代码注释和文档字符串

### 🐛 修复 (Fixed)

- ✅ 修复峰检测导入 - 在主程序中正确导入 `find_peaks`
- ✅ 改进错误处理 - 更友好的错误提示

### 📦 文件结构

```
FTIR_Processor/
├── FTIR_Processor.py       # 主程序 (v2.0, 1630+ 行)
├── config_manager.py        # 配置管理模块 (新增)
├── batch_processor.py       # 批量处理模块 (新增)
├── requirements.txt         # 依赖声明 (新增)
├── example_config.json      # 配置文件示例 (新增)
├── 新功能说明.md            # 功能文档 (新增)
├── CHANGELOG.md             # 更新日志 (新增)
├── README.md               # 项目说明
├── test.CSV                # 测试数据
└── .gitignore              # Git 忽略规则
```

---

## [1.0.0] - 2024-初始版本

### 功能特性

#### 平滑处理
- ✅ Savitzky-Golay 滤波
- ✅ LOWESS 局部平滑
- ✅ 移动平均
- ✅ 高斯滤波
- ✅ 中值滤波
- ✅ 范围选择平滑
- ✅ 参数可调

#### 基线校正
- ✅ Rubberband (橡皮带法)
- ✅ 修正多项式
- ✅ 自适应迭代多项式
- ✅ Whittaker-ASLS
- ✅ 平滑样条混合模型
- ✅ 数据源选择（原始/平滑后）

#### 特征峰分析
- ✅ 自动寻峰
- ✅ 峰位置和高度检测
- ✅ 峰面积计算（梯形积分）
- ✅ 基线校正峰面积
- ✅ 范围分析
- ✅ 峰列表导出

#### 用户界面
- ✅ 三个功能页面（标签页）
- ✅ 实时图形显示
- ✅ 参数动态更新
- ✅ 帮助说明窗口
- ✅ 中文界面

#### 数据导入导出
- ✅ CSV 文件导入
- ✅ CSV 数据导出
- ✅ 结果复制到剪贴板

---

## 版本对比

| 特性分类 | v1.0 | v2.0 |
|---------|------|------|
| **核心功能** | | |
| 平滑处理 | 5种方法 | 5种方法 ✅ |
| 基线校正 | 5种方法 | 5种方法 ✅ |
| 峰分析 | 基础功能 | 基础功能 ✅ |
| **配置管理** | ❌ | ✅ **新增** |
| **批量处理** | ❌ | ✅ **新增** |
| **增强导出** | CSV 基础 | Excel + 元数据 ✅ |
| **用户界面** | 基础GUI | 菜单栏 + 对话框 ✅ |
| **代码行数** | ~1,240 | ~1,630 |
| **模块数** | 1 | 3 |
| **文档** | README | README + 新功能说明 + CHANGELOG |

---

## 升级指南

### 从 v1.0 升级到 v2.0

1. **安装新依赖**：
   ```bash
   pip install -r requirements.txt
   ```

2. **下载新模块**：
   - `config_manager.py`
   - `batch_processor.py`

3. **替换主程序**：
   - 更新 `FTIR_Processor.py` 到 v2.0

4. **测试运行**：
   ```bash
   python FTIR_Processor.py
   ```

5. **检查菜单栏**：
   - 如果看到"文件"、"导出"、"帮助"菜单，升级成功

### 兼容性说明

- ✅ 完全向后兼容 - v1.0 的所有功能保持不变
- ✅ 数据格式兼容 - 使用相同的 CSV 格式
- ✅ 可选增强 - 没有新模块也能运行基本功能

---

## 已知问题

### v2.0

- ⚠️ 批量处理大量文件（>1000个）可能占用较多内存
  - **解决方案**：分批处理

- ⚠️ Excel 导出需要 openpyxl 库
  - **解决方案**：`pip install openpyxl`

---

## 未来计划

### v2.1 (计划中)

- [ ] 性能优化：图形渲染加速
- [ ] 实时预览：参数调整时实时显示效果
- [ ] 撤销/重做：支持操作撤销
- [ ] 数据对比：同时查看多个样品

### v3.0 (远期规划)

- [ ] 深度模块化：完全的模块化架构
- [ ] 插件系统：支持自定义处理算法
- [ ] Web 界面：基于浏览器的操作界面
- [ ] 云处理：支持云端批量处理

---

## 贡献者

**主要开发者**：zjnuxsl (sl-xiao@zjnu.cn)

---

## 许可证

本项目仅供学术研究使用。

---

**最后更新**：2024-01-15
